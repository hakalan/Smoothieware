function runCommand(e,t){var n=$("#commandForm");e+="\n";url=t?"/command_silent":"/command";var r=$.post(url,e);if(!t){r.done(function(e){$("#result").empty();$.each(e.split("\n"),function(e){$("#result").append(this+"<br/>")})})}}function runCommandSilent(e){runCommand(e,true)}function runCommandCallback(e,t){var n="/command";e+="\n";var r=$.post(n,e,t)}function jogXYClick(e){runCommand("G91 G0 "+e+" F"+document.getElementById("xy_velocity").value+" G90",true)}function jogZClick(e){runCommand("G91 G0 "+e+" F"+document.getElementById("z_velocity").value+" G90",true)}function extrude(e,t,n){var r=document.getElementById("extrude_length").value;var i=document.getElementById("extrude_velocity").value;var s=e.currentTarget.id=="extrude"?1:-1;runCommand("G91 G0 E"+r*s+" F"+i+" G90",true)}function motorsOff(e){runCommand("M18",true)}function heatSet(e){var t=e.currentTarget.id=="heat_set"?104:140;var n=t==104?document.getElementById("heat_value").value:document.getElementById("bed_value").value;runCommand("M"+t+" S"+n,true)}function heatOff(e){var t=e.currentTarget.id=="heat_off"?104:140;runCommand("M"+t+" S0",true)}function getTemperature(){runCommand("M105",false)}function fanSet(e){var t=document.getElementById("fan_value").value;runCommand("M106 S"+t,true)}function fanOff(){runCommand("M107",true)}function handleFileSelect(e){var t=e.target.files;var n=[];for(var r=0,i;i=t[r];r++){n.push("<li><strong>",escape(i.name),"</strong> (",i.type||"n/a",") - ",i.size," bytes, last modified: ",i.lastModifiedDate?i.lastModifiedDate.toLocaleDateString():"n/a","</li>")}document.getElementById("list").innerHTML="<ul>"+n.join("")+"</ul>"}function upload(){$("#progress").empty();$("#uploadresult").empty();var e=document.getElementById("files").files[0];var t=new FileReader;t.readAsBinaryString(e);t.onloadend=function(t){xhr=new XMLHttpRequest;xhr.open("POST","upload",true);xhr.setRequestHeader("X-Filename",e.name);XMLHttpRequest.prototype.mySendAsBinary=function(e){var t=new ArrayBuffer(e.length);var n=new Uint8Array(t,0);for(var r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;if(typeof window.Blob=="function"){var i=new Blob([t])}else{var s=new(window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder);s.append(t);var i=s.getBlob()}this.send(i)};var n=xhr.upload||xhr;n.addEventListener("progress",function(e){var t=e.position||e.loaded;var n=e.totalSize||e.total;var r=Math.round(t/n*100);$("#progress").empty().append("uploaded "+r+"%")});xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){$("#uploadresult").empty().append("Uploaded Ok")}else{$("#uploadresult").empty().append("Uploaded Failed")}}};xhr.mySendAsBinary(t.target.result)}}function playFile(e){runCommandSilent("play /sd/"+e)}function refreshFiles(){document.getElementById("fileList").innerHTML="";runCommandCallback("M20",function(e){$.each(e.split("\n"),function(e){var t=this.trim();if(t.match(/\.g(code)?$/)){var n=document.getElementById("fileList");var r=n.insertRow(-1);var i=r.insertCell(0);var s=document.createTextNode(t);i.appendChild(s);i=r.insertCell(1);i.innerHTML="[<a href='javascript:void(0);' onclick='playFile(\""+t+"\");'>Play</a>]"}})})}