function runCommand(e,t){if(!busy){busy=true;var n=$("#address").val()+"/command";e+="\n";$.post(n,e,t).fail(function(){log("No contact with printer!")}).always(function(){busy=false})}else{log("Busy!")}}function log(e){var t=$("#commandlog");t.append(e+"\n");t.scrollTop(t.prop("scrollHeight"))}function logCommand(e,t){log(e);runCommand(e,function(e){log(e);if(t)t(e)})}function send(e){cmd=$("#commandText").val();logCommand(cmd);$("#commands").append('<option value="'+cmd+'"></option>')}function jogXYClick(e){logCommand("G91 G0 "+e+" F"+$("#xy_velocity").val()+" G90")}function jogZClick(e){logCommand("G91 G0 "+e+" F"+$("#z_velocity").val()+" G90")}function extrude(e,t,n){var r=$("#extrude_length").val();var i=$("#extrude_velocity").val();var s=e.currentTarget.id=="extrude"?1:-1;logCommand("G91 G0 E"+r*s+" F"+i+" G90")}function motorsOff(e){logCommand("M18")}function heatSet(e){var t=e.currentTarget.id=="heat_set"?104:140;var n=t==104?$("#heat_value").val():$("#bed_value").val();logCommand("M"+t+" S"+n)}function heatOff(e){var t=e.currentTarget.id=="heat_off"?104:140;logCommand("M"+t+" S0")}function getTemperature(){logCommand("M105",false)}function fanSet(e){logCommand("M106 S"+$("#fan_value").val())}function fanOff(){$("#fan_value").val(0);logCommand("M107")}function handleFileSelect(e){var t=e.target.files;var n=[];for(var r=0,i;i=t[r];r++){n.push("<li><strong>",escape(i.name),"</strong> (",i.type||"n/a",") - ",i.size," bytes, last modified: ",i.lastModifiedDate?i.lastModifiedDate.toLocaleDateString():"n/a","</li>")}document.getElementById("list").innerHTML="<ul>"+n.join("")+"</ul>"}function upload(){$("#progress").empty();$("#uploadresult").empty();var e=document.getElementById("files").files[0];var t=new FileReader;t.readAsBinaryString(e);t.onloadend=function(t){xhr=new XMLHttpRequest;xhr.open("POST","upload",true);xhr.setRequestHeader("X-Filename",e.name);XMLHttpRequest.prototype.mySendAsBinary=function(e){var t=new ArrayBuffer(e.length);var n=new Uint8Array(t,0);for(var r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;if(typeof window.Blob=="function"){var i=new Blob([t])}else{var s=new(window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder);s.append(t);var i=s.getBlob()}this.send(i)};var n=xhr.upload||xhr;n.addEventListener("progress",function(e){var t=e.position||e.loaded;var n=e.totalSize||e.total;var r=Math.round(t/n*100);$("#progress").empty().append("uploaded "+r+"%")});xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){$("#uploadresult").empty().append("Uploaded Ok")}else{$("#uploadresult").empty().append("Uploaded Failed")}}};xhr.mySendAsBinary(t.target.result)}}function playFile(e){logCommand("play /sd/"+e)}function refreshFiles(){document.getElementById("fileList").innerHTML="";logCommand("M20",function(e){$.each(e.split("\n"),function(e){var t=this.trim();if(t.match(/\.g(code)?$/)){var n=document.getElementById("fileList");var r=n.insertRow(-1);var i=r.insertCell(0);var s=document.createTextNode(t);i.appendChild(s);i=r.insertCell(1);i.innerHTML="[<a href='javascript:void(0);' onclick='playFile(\""+t+"\");'>Play</a>]"}})})}var busy=false;$(function(){function s(e,t){if(t.length>n){t.shift()}t.push(e);var r=[];for(var i=0;i<t.length;++i){r.push([i,t[i]])}return r}function o(r){var o=/([A-Z]):([0-9.]+).*\/([0-9.]+).*([A-Z]):([0-9.]+).*\/([0-9.]+)/;var u=o.exec(r);var a=s(Number(u[2]),e);var f=s(Number(u[5]),t);var l=Number(u[3]);var c=Number(u[6]);i.setData([{label:u[1],lines:{lineWidth:3},data:a},{lines:{lineWidth:1},data:[[0,l],[n,l]]},{label:u[4],lines:{lineWidth:3},data:f},{lines:{lineWidth:1},data:[[0,c],[n,c]]}]);i.setupGrid();i.draw()}function a(){u+=.05;return"T:"+(100+Math.sin(u)*100)+"/200 @0 "+"B:"+(50+Math.cos(u)*50)+"/55 @0"}function f(){if($("#sim").is(":checked")){o(a())}else{runCommand("M105",o)}}var e=[],t=[],n=100,r;var i=$.plot("#tempGraph",[],{series:{shadowSize:0},yaxis:{min:0},xaxis:{min:0,max:n,show:false},colors:["#d00000","#e02020","#0000d0","#2020e0"],legend:{position:"nw"}});i.draw();var u=0;var l;$("#enablegraph").click(function(e){if(this.checked){var t=$("#updateInterval").val();l=setInterval(f,t)}else{clearInterval(l)}})});$(function(){document.getElementById("files").addEventListener("change",handleFileSelect,false)})